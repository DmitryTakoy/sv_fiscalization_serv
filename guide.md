# Руководство по использованию сервиса фискализации SmartVend

## Начало работы

### Настройка вебхука в SmartVend

1. Войдите в личный кабинет SmartVend
2. Перейдите в раздел "Настройки" -> "Интеграции" -> "Вебхуки"
3. Нажмите кнопку "Создать"
4. Заполните форму:
   - В поле "Хост (URL)" укажите: `http://91.236.196.187:8001/fiscalization`
   - В поле "Триггер" выберите "Фискализация"
   - Убедитесь, что переключатель "Включено" активирован
5. Нажмите кнопку "Создать"

После этого все данные о фискализации будут автоматически отправляться на сервис, и для каждого автомата станет доступна страница с QR-кодом чека.

## Назначение сервиса

Сервис предназначен для:
1. Приема и обработки данных фискализации от автоматов SmartVend
2. Хранения информации о чеках
3. Генерации QR-кодов для проверки чеков через приложение ФНС
4. Предоставления удобного веб-интерфейса для просмотра чеков

## Основные функции

### 1. Получение чека по серийному номеру автомата

Для получения чека используйте следующий формат URL:
```
http://91.236.196.187:8001/fiscalization/check?serial=СЕРИЙНЫЙ_НОМЕР
```

Где `СЕРИЙНЫЙ_НОМЕР` - это серийный номер автомата (например, 23430024).

#### Примеры ссылок:
- http://91.236.196.187:8001/fiscalization/check?serial=23430024
- http://91.236.196.187:8001/fiscalization/check?serial=22350153

### 2. Форматы вывода

Сервис поддерживает два формата вывода чека:

1. HTML страница (по умолчанию):
```
http://91.236.196.187:8001/fiscalization/check?serial=СЕРИЙНЫЙ_НОМЕР
```

2. Только QR-код (изображение):
```
http://91.236.196.187:8001/fiscalization/check?serial=СЕРИЙНЫЙ_НОМЕР&format=image
```

## Как использовать

### Для клиентов/покупателей:
1. Отсканируйте QR-код на экране автомата (если есть)
2. Или перейдите по ссылке, указанной на автомате
3. На открывшейся странице вы увидите:
   - QR-код чека
   - Информацию о чеке (ФН, ФП, номер чека, дата, сумма)
   - Инструкцию по проверке чека через приложение ФНС

### Для администраторов:
1. Просмотр всех логов фискализации доступен по адресу:
   ```
   http://91.236.196.187:8001/
   ```
2. Для каждого автомата сохраняется только последний чек
3. При получении нового чека старый автоматически обновляется

## Рекомендации по интеграции

### 1. Генерация QR-кодов для автоматов
Рекомендуется создать QR-коды для каждого автомата, содержащие ссылку на получение чека. Это можно сделать с помощью любого генератора QR-кодов, используя ссылку вида:
```
http://91.236.196.187:8001/fiscalization/check?serial=СЕРИЙНЫЙ_НОМЕР
```

### 2. Размещение информации на автомате
На каждом автомате рекомендуется разместить:
- QR-код для быстрого получения чека
- Текстовую ссылку для ручного ввода
- Краткую инструкцию по получению чека

## Технические детали

### API Endpoints:
1. `GET /fiscalization/check?serial={serial}` - получение чека в HTML формате
2. `GET /fiscalization/check?serial={serial}&format=image` - получение только QR-кода
3. `GET /` - просмотр всех логов фискализации
4. `POST /fiscalization` - эндпоинт для приема данных фискализации

### Хранение данных:
- Все чеки хранятся в базе данных SQLite
- Для каждого серийного номера хранится только актуальный чек
- История фискализации сохраняется полностью

## Поддержка и обратная связь

По всем вопросам обращайтесь:
- Email: info@smartvend.ru
- Telegram: DmitryEduardovich

## Планы по развитию

1. Добавление API для массового получения QR-кодов
2. Интеграция с системой мониторинга автоматов
3. Добавление статистики по чекам
4. Экспорт данных в различные форматы 